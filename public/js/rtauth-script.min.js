!function(t,a,r){var o,n=rtGlobalObj.authApi.facebookAppId,s=rtGlobalObj.authApi.togoClientId,i=t.getElementsByTagName(a)[0];t.getElementById("rtrvjs")||((o=t.createElement(a)).id="rtrvjs",o.src=rtGlobalObj.authApi.rtrvHostUrl,o.async=!0,e=[],window.RTRV={onLoad:function(t){e.push(t)},e:e,facebookAppId:n,togoClientId:s},i.parentNode.insertBefore(o,i))}(document,"script");var rtrv,proUser=rtGlobalObj.authApi.proUserIdent,regUser=rtGlobalObj.authApi.regUserIdent,cookieName="wpe-us",ranOnce=!1;function addPreloader(e){let t=e.innerHTML;return e.innerHTML='<span class="lds-spinner"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span>',t}function removePreloader(e,t){e.innerHTML=t}function showMessage(e,t){let a=e.closest(".popup__window").querySelector(".popup__error-message"),r=e.closest(".popup__window").querySelector("form");a.innerHTML=t,a.style.display="block",r.classList.add("error")}function removeMessage(e){let t=e.closest(".popup__window").querySelector(".popup__error-message"),a=e.closest(".popup__window").querySelector("form");t.innerHTML="",t.style.display="none",a.classList.remove("error")}function setCookie(e,t,a){let r="";{let e=new Date;e.setTime(e.getTime()+31536e6),r=";expires="+e.toUTCString()}document.cookie=e+"="+t+r+";path=/",a&&window.location.reload()}function getCookie(e){let t=e+"=",a=document.cookie.split(";");for(let e=0;e<a.length;e++){let r=a[e];for(;" "==r.charAt(0);)r=r.substring(1,r.length);if(0==r.indexOf(t))return r.substring(t.length,r.length)}return null}function deleteCookie(e,t){document.cookie=e+"=;expires=Thu, 01 Jan 1970 00:00:01 GMT;path=/",t&&window.location.reload()}function show_roadpass_modal(e){document.body.classList.add("overflowed"),document.querySelector("html").classList.add("overflowed"),document.querySelector(".popup").classList.remove("popup_visible"),document.querySelector("#overlay").classList.add("overlay_visible"),document.querySelector("#main-nav").classList.remove("main-nav_visible"),document.getElementById(e).classList.add("popup_visible")}RTRV.onLoad((function(){if(0==ranOnce){ranOnce=!0;let l=rtGlobalObj.rtApi.hostUrl;var e;switch(l){case"roadtrippers.com":e={host:"https://api2."+l};break;default:e={host:"https://api2."+l,httpBasicAuth:{password:rtGlobalObj.authApi.stageAuthP,userId:rtGlobalObj.authApi.stageAuthU}}}rtrv=new RTRV(e);for(var t=document.querySelectorAll(".popup-opener"),a=document.querySelectorAll(".authorize-with-roadpass"),r=document.querySelectorAll(".rtauth-logout"),o=document.getElementById("fb-email"),n=document.querySelectorAll(".popup__input"),s=0;s<n.length;s++)n[s].addEventListener("focus",(function(e){removeMessage(this)}));rtrv.getUser().then((function(e){rtGlobalObj.user.data=e,rtGlobalObj.user.type="regular",window.dataLayer=window.dataLayer||[],e.email&&window.dataLayer.push({email:e.email,event:"user"}),e.stripe_id&&window.dataLayer.push({stripe_id:e.stripe_id,event:"user"}),e.is_pro&&(rtGlobalObj.tracking.properties.membership_level="roadtrippers plus",rtGlobalObj.user.type="plus"),function(){if(t)for(let e=0;e<t.length;e++)t[e].classList.add("rtauth-hidden");if(a)for(let e=0;e<a.length;e++)a[e].classList.add("rtauth-hidden");if(r)for(let e=0;e<r.length;e++)r[e].classList.remove("rtauth-hidden")}();let o='<img src="'+e.image_v_50x50_url+'" />';e.username&&(o='<a href="https://maps.'+l+"/people/"+e.username+'" target="_blank">'+o+"</a>");let n=document.querySelector(".rt-user-img");if(n&&(n.innerHTML=o,n.classList.remove("rtauth-hidden")),e.is_pro?setCookie(cookieName,proUser,!1):setCookie(cookieName,regUser,!1),rtrv.isUserRVer({}).then((function(e){rtGlobalObj.user.data.RVer=e;let t=new Event("userReady");document.dispatchEvent(t)}),(function(){rtGlobalObj.user.data.RVer=!1,console.log("error getting RV status");let e=new Event("userReady");document.dispatchEvent(e)})),e.show_roadpass_cta){show_roadpass_modal("proactive");let e=Object.assign({},rtGlobalObj.tracking.properties);document.addEventListener("analyticsReady",(function(){analytics.track("Account Migration CTA Viewed",e)})),rtrv.roadpassProactiveShown()}e.show_recently_roadpass_connected&&(show_roadpass_modal("roadpass-success"),rtrv.roadpassConnectionSuccessShown())}),(function(){!function(){if(r)for(let e=0;e<r.length;e++)r[e].classList.add("rtauth-hidden");if(t)for(let e=0;e<t.length;e++)t[e].classList.remove("rtauth-hidden");if(a)for(let e=0;e<a.length;e++)a[e].classList.remove("rtauth-hidden")}(),deleteCookie(cookieName,!1),rtrv.isUserRVer({}).then((function(e){rtGlobalObj.user.data.RVer=e;let t=new Event("userReady");document.dispatchEvent(t)}),(function(){rtGlobalObj.user.data.RVer=!1,console.log("error getting RV status");let e=new Event("userReady");document.dispatchEvent(e)}))}));let d=document.getElementById("authorize-with-password");d.addEventListener("submit",(function(e){e.preventDefault();let t=d.querySelector(".popup__submit"),a=addPreloader(t),r={login:document.getElementById("login-username").value,password:document.getElementById("login-password").value,token:e.detail};rtrv.authorizeWithPassword(r).then((function(e){rtGlobalObj.user.data=e,e.is_pro&&(rtGlobalObj.tracking.properties.membership_level="roadtrippers plus");let t=Object.assign({},rtGlobalObj.tracking.properties);t.authenticated_by="roadtrippers",analytics.identify(e.id,{id:e.id.toString(),username:e.username,email:e.email,name:e.name},(function(){analytics.track("User Signed In",t,{},(function(){rtGlobalObj.user.data.is_pro?setCookie(cookieName,proUser,!0):setCookie(cookieName,regUser,!0)}))}))}),(function(e){removePreloader(t,a);showMessage(t,"Invalid username or email and password");t.closest(".popup__window").querySelector(".popup__close").addEventListener("click",(function(e){removeMessage(t)}))}))}));let c=document.getElementsByClassName("authorize-with-fb");for(let e=0;e<c.length;e++)c[e].addEventListener("click",(function(e){e.preventDefault();var t=this;let a=addPreloader(t);rtrv.authorizeWithFB({}).then((function(e){rtGlobalObj.user.data=e,e.is_pro&&(rtGlobalObj.tracking.properties.membership_level="roadtrippers plus");let t=Object.assign({},rtGlobalObj.tracking.properties);t.authenticated_by="facebook";let a="User Signed In";e.new_user&&(a="User Signed Up",analytics.alias(e.id)),analytics.identify(e.id,{id:e.id.toString(),username:e.username,email:e.email,name:e.name},(function(){analytics.track(a,t,{},(function(){rtGlobalObj.user.data.is_pro?setCookie(cookieName,proUser,!0):setCookie(cookieName,regUser,!0)}))}))}),(function(e){e.missing_email?i():e.togo_only?show_roadpass_modal("fb-roadpass-error"):e.errors&&console.log(e.errors),removePreloader(t,a),t.closest(".popup__window").querySelector(".popup__close").addEventListener("click",(function(e){removeMessage(t)}))}))}));function i(){document.querySelector(".popup").classList.remove("popup_visible"),document.getElementById("overlay").classList.add("overlay_visible"),o.classList.add("popup_visible")}o.querySelector(".prompt-cancel").addEventListener("click",(function(e){e.preventDefault(),document.getElementById("overlay").classList.remove("overlay_visible"),o.classList.remove("popup_visible")})),o.querySelector("#fb-auth-email-submit").addEventListener("click",(function(e){e.preventDefault();document.querySelector("#fb-auth-email-form");let t=document.querySelector("#fb-auth-email-wrapper"),a=document.querySelector("#fb-auth-email"),r=document.querySelector(".popup__fb-auth-email-error-message");if(0===a.value.length)t.classList.add("error"),r.innerHTML="Email field cannot be empty";else{var o=this;let e=addPreloader(o),t={email:a.value};rtrv.authorizeWithFB(t).then((function(e){rtGlobalObj.user.data=e,e.is_pro&&(rtGlobalObj.tracking.properties.membership_level="roadtrippers plus");let t=Object.assign({},rtGlobalObj.tracking.properties);t.authenticated_by="facebook";let a="User Signed In";e.new_user&&(a="User Signed Up",analytics.alias(e.id)),analytics.identify(e.id,{id:e.id.toString(),username:e.username,email:e.email,name:e.name},(function(){analytics.track(a,t,{},(function(){rtGlobalObj.user.data.is_pro?setCookie(cookieName,proUser,!0):setCookie(cookieName,regUser,!0)}))}))}),(function(t){t.errors&&"Email must be valid"===t.errors[0].message?r.innerHTML="Email does not appear to be valid. Please enter another and try again.":t.errors&&(r.innerHTML=t.errors[0].message),removePreloader(o,e)}))}}));let p=document.getElementsByClassName("authorize-with-roadpass");for(let e=0;e<p.length;e++)p[e].addEventListener("click",(function(e){e.preventDefault();addPreloader(this);let t={},a=this.dataset.state;t.clientState=a;let r="maps."+rtGlobalObj.rtApi.hostUrl;r&&(t.mapsHost=r);var o=this.dataset.location;if("module sign up"==o){let e=window.location.href;e=e+"#"+this.closest(".page-content-item").id,t.returnTo=e}if(void 0!==o){let e=Object.assign({},rtGlobalObj.tracking.properties);e.context=o,analytics.track("Authentication Prompted",e,{},(function(){rtrv.authorizeWithRoadpass(t)}))}else rtrv.authorizeWithRoadpass(t)}));let u=document.getElementsByClassName("authorize-with-apple");for(let e=0;e<u.length;e++)u[e].addEventListener("click",(function(e){e.preventDefault(),rtrv.authorizeWithApple()}));if(r)for(let e=0;e<r.length;e++)r[e].addEventListener("click",(function(){rtrv.logout().then((function(){analytics.reset(),deleteCookie(cookieName,!0)}),(function(){}))}))}})),document.addEventListener("analyticsReady",(function(){let e=document.getElementsByClassName("proactive-roadpass-connect");for(let t=0;t<e.length;t++)e[t].addEventListener("click",(function(e){e.preventDefault();addPreloader(this);let t={},a="maps."+rtGlobalObj.rtApi.hostUrl;a&&(t.mapsHost=a),t.clientState="connect";let r=Object.assign({},rtGlobalObj.tracking.properties);r.context="connect modal",analytics.track("Account Migration Initiated",r,{},(function(){rtrv.authorizeWithRoadpass(t)}))}))})),document.addEventListener("analyticsReady",(function(){if(window.location.search.length>0&&window.location.href.indexOf("roadpass_redirect")>0&&0!==Object.entries(rtGlobalObj.user.data).length&&rtGlobalObj.user.data.constructor===Object){let e=Object.assign({},rtGlobalObj.tracking.properties);e.authenticated_by="roadpass";let t="User Signed In";rtGlobalObj.user.data.new_user&&(t="User Signed Up",analytics.alias(rtGlobalObj.user.data.id)),analytics.identify(rtGlobalObj.user.data.id,{id:rtGlobalObj.user.data.id.toString(),username:rtGlobalObj.user.data.username,name:rtGlobalObj.user.data.name,email:rtGlobalObj.user.data.email},(function(){analytics.track(t,e)}))}})),document.addEventListener("analyticsReady",(function(){if(window.location.search.length>0&&window.location.href.indexOf("apple_login")>0&&0!==Object.entries(rtGlobalObj.user.data).length&&rtGlobalObj.user.data.constructor===Object){let e="";window.location.href.indexOf("?apple_login&")>0?e=window.location.href.replace("apple_login&",""):window.location.href.indexOf("&apple_login")>0?e=window.location.href.replace("&apple_login",""):window.location.href.indexOf("?apple_login")>0&&(e=window.location.href.replace("?apple_login",""));let t=Object.assign({},rtGlobalObj.tracking.properties);t.authenticated_by="apple";let a="User Signed In";rtGlobalObj.user.data.new_user&&(a="User Signed Up",analytics.alias(rtGlobalObj.user.data.id)),analytics.identify(rtGlobalObj.user.data.id,{id:rtGlobalObj.user.data.id.toString(),username:rtGlobalObj.user.data.username,name:rtGlobalObj.user.data.name,email:rtGlobalObj.user.data.email},(function(){analytics.track(a,t,{},(function(){window.location.href=e}))}))}}));